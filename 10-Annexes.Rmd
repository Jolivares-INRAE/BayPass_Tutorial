# Annexes {-}

## Annexe 1 {-#An1}

Le package R **_poolfstat_** peut être utilisé pour calculer diverses statistiques utilisées dans les études de génomique des populations, ces outils sont décrits et exemplifiés dans la vignette de **_poolfstat_** : (https://cran.r-project.org/web/packages/poolfstat/vignettes/vignette.pdf), parmis ceux-ci on trouve l'analyse des Fst.

### Pairwise {-}
Calcul des Fst entre les populations deux à deux (pairwise) afin de visualiser la proximité génétique entre populations.
```{r heatmap-PW-fst, fig.width=10, fig.height=10, verbose=FALSE, eval=FALSE}
#Calcul des pairwise Fst 
PairWise.fst <- compute.pairwiseFST(pooldata, method = "Anova", min.cov.per.pool = 4, max.cov.per.pool = 1e+06, min.maf = 0.05, output.snp.values = FALSE)
#conversion en matrice de distance
df <- as.matrix(dist(t(PairWise.fst@PairwiseFSTmatrix)))
#heatmap
cim_color <- colorRampPalette(rev(brewer.pal(9, "Reds")))(9)
cim(df, color = cim_color, symkey = FALSE, margins = c(10, 10),  title = "heatmap des pairwise Fst entre les populations")
```

On peut aussi calculer et plotter des Fst multi-locus en balayant le génome avec une fenêtre glissante de SNP consécutifs et un chevauchement d'une demi fenêtre, une région génomique très différenciée apparaitra sous la forme d'une éruption de points colorés.

### Fst en fenêtre glissante {-}
```{r plot-sliding-Fst, verbose=FALSE, eval=FALSE}
#calcul des Fst avec une fenêtre glissante de 100 SNP consécutifs .
Multi.Loc.fst <- computeFST(pooldata, method = "Anova", sliding.window.size = 100)
#conversion en objet data frame
df.fst<-as.data.frame(Multi.Loc.fst$sliding.windows.fst, h=T)
#plot.
Fst.plot = ggplot(data=df.fst, aes(x=CumulatedPosition/1e6, y=MultiLocusFst)) +
  geom_point(aes(color=Chr), alpha=0.8, size=1.5) +
  ggtitle("Fst en fenêtres glissantes") +
  geom_hline(yintercept=Multi.Loc.fst$FST,lty=2) #le seuil indique la Fst globale estimée à l'échelle du génome
Fst.plot + scale_x_continuous() + scale_y_continuous() +
  theme(axis.title.x=element_blank(), axis.text.x=element_blank(), axis.ticks.x=element_blank()) +
  facet_wrap(~Chr, scales = 'free_x', strip.position =c("bottom")) #affichage des chromosomes en grille
```

## Annexe 2 {-#An2}

```{r SVD, fig.width=10, fig.height=10, verbose=FALSE, eval=FALSE}
pnames <- as.character(c('13-1-S', '18-84-001-S', '17-47-003-S', '17-49-001-S', '85-3-4-S', 'IT-ID3-S', '17-47-002-R', '17-53-006-R', '19-30-1-R', '44-1-R', '44-2-R', '44-3-R', 'IT-ID1-R'))
pheno <- as.character(c('Susceptible',   'Susceptible',  'Susceptible', 'Susceptible', 'Susceptible', 'Susceptible', 'Resistant', 'Resistant', 'Resistant', 'Resistant', 'Resistant','Resistant','Resistant'))
geo <- as.character(c('SE',   'SE',  'SO', 'NO',   'NO',  'IT', 'SO',   'NO',  'SE','NO','NO','NO','IT'))
nomsU<- as.character(c(' ',   'SE-S-02',  ' ', '',   ' ',  ' ', ' ',   ' ',  ' ',' ',' ',' ',' '))
nomsL<- as.character(c(' ',   ' ',  ' ', 'NO-S-02',   ' ',  'IT-S-01', 'SO-R-01',   'NO-R-04',  'SE-R-01',' ',' ',' ','IT-R-01'))
nomsR<- as.character(c('SE-S-01',   ' ',  'SO-S-01', ' ',   'NO-S-01',  ' ', ' ',   ' ',  ' ',' ',' ',' ',' '))
nomsN1<- as.character(c(' ',   ' ',  ' ', ' ',   ' ',  ' ', ' ',   ' ',  ' ', 'NO-R-01', ' ', ' ', ' '))
nomsN2<- as.character(c(' ',   ' ',  ' ', ' ',   ' ',  ' ', ' ',   ' ',  ' ', ' ', 'NO-R-02', ' ', ' '))
nomsN3<- as.character(c(' ',   ' ',  ' ', ' ',   ' ',  ' ', ' ',   ' ',  ' ', ' ', ' ', 'NO-R-03', ' '))
noms_bis<- as.character(c("01",   "02",  "01", "02",  "01", "01", "01", "04", "01", "01", "02", "03", "01"))
pos<- as.character(c('R',   'T',  'R', 'T',   'R',  'T', 'R',   'R',  'T','R','R','R','R'))
col_geo<- c("#ffc100",   "#ffc100",  "#69ff27", "#00b0f0", "#00b0f0", "#7030a0", "#69ff27", "#00b0f0",  "#ffc100","#00b0f0","#00b0f0","#00b0f0","#7030a0")
# convertit en data.frame
tab_SVD <- data.frame(sample.id = pnames,
    phenotype = factor(pheno),
    region = factor(geo),
    #noms = factor(noms),
    noms_bis = factor(noms_bis),
    nomsUp = factor(nomsU),
    nomsLeft = factor(nomsL),
    nomsRight = factor(nomsR),
    nomsN1 = factor(nomsN1),
    nomsN2 = factor(nomsN2),
    nomsN3 = factor(nomsN3),
    colPop=col_geo,
    pos = factor(pos),
    PC = SVD_omega$PC,    # the first eigenvector
    eig = SVD_omega$eig,    # the second eigenvector
    VAR = SVD_omega$pcent.var,    # variance proportion for each principal component
    stringsAsFactors = FALSE)

ggplot_svd = ggplot(data=tab_SVD, aes(x=PC.1, y=PC.2, shape=phenotype)) +
  geom_point(aes(color= region),alpha=1, size=10)+scale_shape_manual(values = c('Susceptible'=79, 'Resistant'=16))+
  ggtitle(paste0("Singular Value Decomposition of the covariance (",expression("\U03A9"),") matrix for Z chromosome"))+
  scale_colour_manual(name = "region",labels = c("IT", "NO", "SE", "SO"), values = c("#7030a0", "#00b0f0", "#ffc100","#69ff27" ),guide = guide_legend(override.aes = list(pch=126)))
ggplot_svd + scale_x_continuous() + scale_y_continuous() +
  xlab(paste("PC1 (",round(tab_SVD$VAR[1], 2), "%)" , sep="")) +  ylab(paste("PC2 (", round(tab_SVD$VAR[2], 2), "%)" , sep="")) +
  geom_text(aes(label = nomsLeft), nudge_x = -0.05,fontface = 'bold')+
  geom_text(aes(label = nomsUp), nudge_y = 0.04,fontface = 'bold')+
  geom_text(aes(label = nomsRight), nudge_x = 0.05,fontface = 'bold')+
  geom_text(aes(label = nomsN1), nudge_x = 0.03, nudge_y = 0.03, fontface = 'bold')+
  geom_text(aes(label = nomsN2), nudge_x = 0.05, nudge_y = 0.00, fontface = 'bold')+
  geom_text(aes(label = nomsN3), nudge_x = 0.03, nudge_y = -0.03, fontface = 'bold')+
  theme(axis.title.x = element_text(size =15, face = "bold"))+theme(axis.title.y = element_text(size =15, face = "bold"))
```